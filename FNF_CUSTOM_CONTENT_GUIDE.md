# üéÆ Friday Night Funkin' - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

## Codename Engine –¥–ª—è macOS

**–í–µ—Ä—Å–∏—è –¥–≤–∏–∂–∫–∞:** 1.0.1
**–ü—É—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏:** `/Users/larry/t/game/fnf/CodenameEngine-Build/CodenameEngine.app`
**–†–µ—Å—É—Ä—Å—ã:** `Contents/Resources/assets/`

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
assets/
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ characters/          # XML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ stages/              # XML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å—Ü–µ–Ω
‚îÇ   ‚îî‚îÄ‚îÄ weeks/
‚îÇ       ‚îú‚îÄ‚îÄ weeks/           # XML —Ñ–∞–π–ª—ã –Ω–µ–¥–µ–ª—å
‚îÇ       ‚îú‚îÄ‚îÄ characters/      # XML –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –¥–ª—è –º–µ–Ω—é
‚îÇ       ‚îî‚îÄ‚îÄ weeks.txt        # –ü–æ—Ä—è–¥–æ–∫ –Ω–µ–¥–µ–ª—å
‚îú‚îÄ‚îÄ images/
‚îÇ   ‚îú‚îÄ‚îÄ characters/          # –°–ø—Ä–∞–π—Ç-–ª–∏—Å—Ç—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ icons/               # –ò–∫–æ–Ω–∫–∏ –¥–ª—è health bar
‚îÇ   ‚îú‚îÄ‚îÄ stages/              # –§–æ–Ω—ã –∏ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—Ü–µ–Ω
‚îÇ   ‚îî‚îÄ‚îÄ menus/storymenu/
‚îÇ       ‚îú‚îÄ‚îÄ weeks/           # –ö–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–∞–∑–≤–∞–Ω–∏–π –Ω–µ–¥–µ–ª—å
‚îÇ       ‚îî‚îÄ‚îÄ characters/      # –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ –¥–ª—è –º–µ–Ω—é –≤—ã–±–æ—Ä–∞
‚îî‚îÄ‚îÄ songs/
    ‚îî‚îÄ‚îÄ [song_name]/
        ‚îú‚îÄ‚îÄ song/            # –ê—É–¥–∏–æ —Ñ–∞–π–ª—ã
        ‚îÇ   ‚îú‚îÄ‚îÄ Inst.ogg     # –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª
        ‚îÇ   ‚îî‚îÄ‚îÄ Voices.ogg   # –ì–æ–ª–æ—Å–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        ‚îú‚îÄ‚îÄ charts/          # –ß–∞—Ä—Ç—ã (–Ω–æ—Ç—ã)
        ‚îÇ   ‚îú‚îÄ‚îÄ easy.json
        ‚îÇ   ‚îú‚îÄ‚îÄ normal.json
        ‚îÇ   ‚îî‚îÄ‚îÄ hard.json
        ‚îî‚îÄ‚îÄ meta.json        # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–µ—Å–Ω–∏
```

---

## üë§ –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –§–æ—Ä–º–∞—Ç: PNG —Å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º —Ñ–æ–Ω–æ–º
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 300-500px –ø–æ –≤—ã—Å–æ—Ç–µ
- –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ: –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–∑—ã –∏–ª–∏ –æ–¥–Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

### 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ø—Ä–∞–π—Ç-–ª–∏—Å—Ç–∞ –∏–∑ –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏

```python
from PIL import Image
import numpy as np

# –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ —Ñ–æ–Ω–∞
img = Image.open("character.png").convert('RGBA')
data = np.array(img)

# –£–¥–∞–ª–µ–Ω–∏–µ –±–µ–ª–æ–≥–æ —Ñ–æ–Ω–∞
white_mask = (data[:,:,0] > 240) & (data[:,:,1] > 240) & (data[:,:,2] > 240)
data[white_mask, 3] = 0
img_clean = Image.fromarray(data)

# Resize –¥–æ –Ω—É–∂–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
scale = 400 / img_clean.height
img_resized = img_clean.resize((int(img_clean.width * scale), 400))

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–π
def tilt(img, angle):
    return img.rotate(angle, expand=True, fillcolor=(0,0,0,0))

frames = {
    'idle': [img_resized, img_resized.resize((img_resized.width, int(img_resized.height * 0.97)))],
    'singLEFT': [tilt(img_resized, 10)],
    'singDOWN': [img_resized.resize((int(img_resized.width * 1.08), int(img_resized.height * 0.90)))],
    'singUP': [img_resized.resize((int(img_resized.width * 0.92), int(img_resized.height * 1.08)))],
    'singRIGHT': [tilt(img_resized, -10)],
}

# –°–±–æ—Ä–∫–∞ —Å–ø—Ä–∞–π—Ç-–ª–∏—Å—Ç–∞ (3x2 —Å–µ—Ç–∫–∞)
# ... —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ PNG
```

### 3. XML —Ñ–∞–π–ª –∞–Ω–∏–º–∞—Ü–∏–π (images/characters/[name].xml)

```xml
<?xml version="1.0" encoding="utf-8"?>
<TextureAtlas imagePath="mychar.png">
    <SubTexture name="mychar idle0000" x="0" y="0" width="400" height="450"/>
    <SubTexture name="mychar idle0001" x="400" y="0" width="400" height="450"/>
    <SubTexture name="mychar singLEFT0000" x="800" y="0" width="400" height="450"/>
    <SubTexture name="mychar singDOWN0000" x="0" y="450" width="400" height="450"/>
    <SubTexture name="mychar singUP0000" x="400" y="450" width="400" height="450"/>
    <SubTexture name="mychar singRIGHT0000" x="800" y="450" width="400" height="450"/>
</TextureAtlas>
```

### 4. XML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (data/characters/[name].xml)

```xml
<!DOCTYPE codename-engine-character>
<character
    y="350"                    <!-- –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è -->
    sprite="mychar"            <!-- –ò–º—è —Å–ø—Ä–∞–π—Ç-–ª–∏—Å—Ç–∞ -->
    flipX="false"              <!-- –û—Ç–∑–µ—Ä–∫–∞–ª–∏—Ç—å –ø–æ X -->
    isPlayer="false"           <!-- true –¥–ª—è –∏–≥—Ä–æ–∫–∞, false –¥–ª—è –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ -->
    isGF="false"               <!-- true –¥–ª—è girlfriend –ø–æ–∑–∏—Ü–∏–∏ -->
    icon="mychar"              <!-- –ò–º—è –∏–∫–æ–Ω–∫–∏ -->
    color="#FF6B00"            <!-- –¶–≤–µ—Ç —Ç–µ–º—ã -->
    scrollFactor="0.95">       <!-- –î–ª—è GF: –ø–∞—Ä–∞–ª–ª–∞–∫—Å -->

    <anim name="idle" anim="mychar idle" fps="12" loop="true"/>
    <anim name="singUP" anim="mychar singUP" fps="24" loop="false"/>
    <anim name="singLEFT" anim="mychar singLEFT" fps="24" loop="false"/>
    <anim name="singRIGHT" anim="mychar singRIGHT" fps="24" loop="false"/>
    <anim name="singDOWN" anim="mychar singDOWN" fps="24" loop="false"/>
</character>
```

### 5. –ò–∫–æ–Ω–∫–∞ –¥–ª—è Health Bar (images/icons/icon-[name].png)

**–§–æ—Ä–º–∞—Ç:** 300x150 PNG (–¥–≤–∞ –∫–∞–¥—Ä–∞ –ø–æ 150x150)
- –õ–µ–≤–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞: –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- –ü—Ä–∞–≤–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞: –ø—Ä–æ–∏–≥—Ä—ã—à–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–∫—Ä–∞—Å–Ω–æ–≤–∞—Ç—ã–π –æ—Ç—Ç–µ–Ω–æ–∫)

### 6. –¢–∏–ø—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π

| –¢–∏–ø | isPlayer | isGF | –ü–æ–∑–∏—Ü–∏—è | –ê–Ω–∏–º–∞—Ü–∏–∏ |
|-----|----------|------|---------|----------|
| –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ | false | false | –°–ª–µ–≤–∞ | idle, sing* |
| –ò–≥—Ä–æ–∫ | true | false | –°–ø—Ä–∞–≤–∞ | idle, sing* |
| GF | false | true | –¶–µ–Ω—Ç—Ä/—Ñ–æ–Ω | danceLeft, danceRight |

---

## üéµ –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Å–Ω–∏

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞—É–¥–∏–æ

```bash
# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å YouTube
yt-dlp -x --audio-format vorbis -o "Inst.ogg" "URL"

# –ò–ª–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ–∞–π–ª–∞
ffmpeg -i input.mp3 -c:a libvorbis -q:a 5 Inst.ogg
```

### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–∫–∏ –ø–µ—Å–Ω–∏

```
songs/mysong/
‚îú‚îÄ‚îÄ song/
‚îÇ   ‚îî‚îÄ‚îÄ Inst.ogg          # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
‚îú‚îÄ‚îÄ charts/
‚îÇ   ‚îî‚îÄ‚îÄ normal.json       # –ú–∏–Ω–∏–º—É–º –æ–¥–Ω–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç—å
‚îî‚îÄ‚îÄ meta.json
```

### 3. meta.json

```json
{
    "displayName": "My Song",
    "bpm": 130.0,
    "icon": "opponent-name",
    "color": "#FF6B00",
    "coopAllowed": true,
    "opponentModeAllowed": true
}
```

### 4. –§–æ—Ä–º–∞—Ç —á–∞—Ä—Ç–∞ (charts/normal.json)

```json
{
    "events": [],
    "strumLines": [
        {
            "visible": true,
            "keyCount": 4,
            "notes": [
                {"id": 0, "sLen": 0, "time": 1000, "type": 0},
                {"id": 1, "sLen": 0, "time": 1500, "type": 0}
            ],
            "position": "dad",
            "type": 0,
            "characters": ["opponent-name"]
        },
        {
            "visible": true,
            "keyCount": 4,
            "notes": [...],
            "position": "boyfriend",
            "type": 1,
            "characters": ["player-name"]
        },
        {
            "keyCount": 4,
            "notes": [],
            "visible": false,
            "position": "girlfriend",
            "type": 2,
            "characters": ["gf-name"]
        }
    ],
    "scrollSpeed": 1.5,
    "chartVersion": "1.6.0",
    "stage": "stage",
    "codenameChart": true,
    "noteTypes": []
}
```

**–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–æ—Ç (id):**
- 0 = LEFT
- 1 = DOWN
- 2 = UP
- 3 = RIGHT

**sLen** = –¥–ª–∏–Ω–∞ —É–¥–µ—Ä–∂–∞–Ω–∏—è (–≤ –º—Å), 0 –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –Ω–æ—Ç

---

## ü§ñ –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install librosa numpy
```

### –ê–ª–≥–æ—Ä–∏—Ç–º –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

```python
import librosa
import numpy as np
import json

# 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ
y, sr = librosa.load("Inst.ogg")

# 2. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –ø–µ—Ä–∫—É—Å—Å–∏—é –∏ –≥–∞—Ä–º–æ–Ω–∏–∫—É (–í–ê–ñ–ù–û!)
y_harmonic, y_percussive = librosa.effects.hpss(y)

# 3. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–º–ø–∞ –ø–æ –ø–µ—Ä–∫—É—Å—Å–∏–∏
onset_env = librosa.onset.onset_strength(y=y_percussive, sr=sr)
tempo, beats = librosa.beat.beat_track(onset_envelope=onset_env, sr=sr)

# 4. –î–µ—Ç–µ–∫—Ü–∏—è onset'–æ–≤ —Å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
onset_times = librosa.onset.onset_detect(
    y=y_percussive,
    sr=sr,
    wait=1,        # –ú–∏–Ω. –æ–∂–∏–¥–∞–Ω–∏–µ –º–µ–∂–¥—É onset'–∞–º–∏
    pre_avg=1,     # –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ –¥–æ
    post_avg=1,    # –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ
    pre_max=1,     # Pre-max –¥–ª—è peak picking
    post_max=1,    # Post-max –¥–ª—è peak picking
    units='time'   # –†–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
)

# 5. –ö–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è –∫ —Ä–∏—Ç–º–∏—á–µ—Å–∫–æ–π —Å–µ—Ç–∫–µ
beat_ms = 60000 / tempo  # –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–∏—Ç–∞ –≤ –º—Å
eighth_note_ms = beat_ms / 2  # 1/8 –Ω–æ—Ç–∞

def quantize(time_ms, grid_ms):
    return round(time_ms / grid_ms) * grid_ms

quantized = [quantize(t * 1000, eighth_note_ms) for t in onset_times]
quantized = sorted(set(quantized))

# 6. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–ª–∏—à–∫–æ–º –±–ª–∏–∑–∫–∏—Ö –Ω–æ—Ç
min_gap = eighth_note_ms * 0.8
filtered = [quantized[0]]
for t in quantized[1:]:
    if t - filtered[-1] >= min_gap:
        filtered.append(t)

# 7. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ—Ç —Å –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏
notes = []
patterns = [[0,1,2,3], [3,2,1,0], [0,2,1,3], [1,3,0,2]]
for i, time_ms in enumerate(filtered):
    pattern = patterns[(i // 8) % len(patterns)]
    direction = pattern[i % 4]
    notes.append({"id": direction, "sLen": 0, "time": int(time_ms), "type": 0})
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|----------|----------|--------------|
| `wait` | –ú–∏–Ω. frames –º–µ–∂–¥—É onset'–∞–º–∏ | 1-3 |
| `pre_avg, post_avg` | –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ –¥–ª—è —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è | 1 |
| `pre_max, post_max` | Peak picking –æ–∫–Ω–æ | 1 |
| –ö–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è | –°–µ—Ç–∫–∞ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è | 1/8 –∏–ª–∏ 1/16 –Ω–æ—Ç—ã |
| `NOTES_PER_TURN` | –ù–æ—Ç –¥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è | 8-16 |

---

## üé≠ –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã (Stage)

### XML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (data/stages/[name].xml)

```xml
<!DOCTYPE codename-engine-stage>
<stage
    zoom="0.9"              <!-- –ú–∞—Å—à—Ç–∞–± –∫–∞–º–µ—Ä—ã -->
    name="mystage"
    folder="stages/mystage/"   <!-- –ü–∞–ø–∫–∞ —Å —Ä–µ—Å—É—Ä—Å–∞–º–∏ -->
    startCamPosY="600"
    startCamPosX="1000">

    <!-- –§–æ–Ω–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (scroll < 1 = –ø–∞—Ä–∞–ª–ª–∞–∫—Å) -->
    <sprite name="bg" x="-600" y="-200" sprite="background" scroll="0.9"/>
    <sprite name="floor" x="-600" y="600" sprite="floor" scroll="0.9"/>

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã -->
    <sprite name="speaker" x="300" y="500" sprite="speaker" scroll="0.95"/>

    <!-- –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ -->
    <girlfriend y="80"/>
    <dad/>
    <boyfriend/>

    <!-- –ü–µ—Ä–µ–¥–Ω–∏–π –ø–ª–∞–Ω (scroll > 1 = –¥–≤–∏–∂–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ) -->
    <sprite name="curtains" x="-500" y="-300" sprite="curtains" scroll="1.3"/>
</stage>
```

### –ê—Ç—Ä–∏–±—É—Ç—ã —Å–ø—Ä–∞–π—Ç–æ–≤

| –ê—Ç—Ä–∏–±—É—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `x, y` | –ü–æ–∑–∏—Ü–∏—è |
| `sprite` | –ò–º—è —Ñ–∞–π–ª–∞ (–±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è) |
| `scroll` | –ü–∞—Ä–∞–ª–ª–∞–∫—Å (0.1 = –º–µ–¥–ª–µ–Ω–Ω–æ, 1.3 = –±—ã—Å—Ç—Ä–æ) |
| `scale` | –ú–∞—Å—à—Ç–∞–± |
| `zoomfactor` | –í–ª–∏—è–Ω–∏–µ –∑—É–º–∞ –∫–∞–º–µ—Ä—ã |

---

## üìÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ–¥–µ–ª–∏

### 1. XML –Ω–µ–¥–µ–ª–∏ (data/weeks/weeks/[name].xml)

```xml
<!DOCTYPE codename-engine-week>
<week
    name="MY WEEK"           <!-- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è -->
    chars="opponent,player,gf"   <!-- –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ –¥–ª—è –ø—Ä–µ–≤—å—é -->
    sprite="myweek"          <!-- –ö–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è -->
    color="FF6B00">          <!-- –¶–≤–µ—Ç —Ç–µ–º—ã (–±–µ–∑ #) -->

    <song>song1</song>
    <song>song2</song>
    <song hide="true">secret_song</song>  <!-- –°–∫—Ä—ã—Ç–∞—è –ø–µ—Å–Ω—è -->
</week>
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ weeks.txt

```
tutorial
week1
week2
...
myweek    <- –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω–µ—Ü
```

### 3. –ö–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è (images/menus/storymenu/weeks/[name].png)

- –†–∞–∑–º–µ—Ä: ~359x89 px
- –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–º —Ñ–æ–Ω–µ
- –®—Ä–∏—Ñ—Ç: Arial Black –∏–ª–∏ Impact

---

## üîß –°–∫—Ä–∏–ø—Ç—ã –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### –ü–æ–ª–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞

```python
#!/usr/bin/env python3
"""
–°–æ–∑–¥–∞–Ω–∏–µ FNF –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∏–∑ –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: python create_character.py image.png character_name
"""

import sys
from PIL import Image
import numpy as np
import os

def create_character(image_path, name, output_dir):
    # –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞
    img = Image.open(image_path).convert('RGBA')
    data = np.array(img)

    # –£–¥–∞–ª–µ–Ω–∏–µ –±–µ–ª–æ–≥–æ/—Å–≤–µ—Ç–ª–æ–≥–æ —Ñ–æ–Ω–∞
    light_mask = (data[:,:,0] > 240) & (data[:,:,1] > 240) & (data[:,:,2] > 240)
    data[light_mask, 3] = 0
    img = Image.fromarray(data)

    # Resize
    scale = 400 / img.height
    img = img.resize((int(img.width * scale), 400), Image.Resampling.LANCZOS)

    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ—Ä–µ–π–º–æ–≤
    def tilt(img, angle):
        return img.rotate(angle, expand=True, fillcolor=(0,0,0,0))

    frames = [
        img,  # idle0
        img.resize((img.width, int(img.height * 0.97))),  # idle1
        tilt(img, 10),   # singLEFT
        img.resize((int(img.width * 1.08), int(img.height * 0.90))),  # singDOWN
        img.resize((int(img.width * 0.92), int(img.height * 1.08))),  # singUP
        tilt(img, -10),  # singRIGHT
    ]

    # –°–ø—Ä–∞–π—Ç-–ª–∏—Å—Ç
    fw = max(f.width for f in frames) + 10
    fh = max(f.height for f in frames) + 10
    sheet = Image.new('RGBA', (fw * 3, fh * 2), (0, 0, 0, 0))

    for i, frame in enumerate(frames):
        x = (i % 3) * fw + (fw - frame.width) // 2
        y = (i // 3) * fh + (fh - frame.height) // 2
        sheet.paste(frame, (x, y), frame)

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    chars_dir = os.path.join(output_dir, "images/characters")
    os.makedirs(chars_dir, exist_ok=True)
    sheet.save(os.path.join(chars_dir, f"{name}.png"))

    # XML –∞–Ω–∏–º–∞—Ü–∏–π
    xml = f'''<?xml version="1.0" encoding="utf-8"?>
<TextureAtlas imagePath="{name}.png">
    <SubTexture name="{name} idle0000" x="0" y="0" width="{fw}" height="{fh}"/>
    <SubTexture name="{name} idle0001" x="{fw}" y="0" width="{fw}" height="{fh}"/>
    <SubTexture name="{name} singLEFT0000" x="{fw*2}" y="0" width="{fw}" height="{fh}"/>
    <SubTexture name="{name} singDOWN0000" x="0" y="{fh}" width="{fw}" height="{fh}"/>
    <SubTexture name="{name} singUP0000" x="{fw}" y="{fh}" width="{fw}" height="{fh}"/>
    <SubTexture name="{name} singRIGHT0000" x="{fw*2}" y="{fh}" width="{fw}" height="{fh}"/>
</TextureAtlas>'''

    with open(os.path.join(chars_dir, f"{name}.xml"), 'w') as f:
        f.write(xml)

    # Character XML
    data_dir = os.path.join(output_dir, "data/characters")
    os.makedirs(data_dir, exist_ok=True)

    char_xml = f'''<!DOCTYPE codename-engine-character>
<character y="350" sprite="{name}" flipX="false" isPlayer="false" icon="{name}" color="#00FF00">
    <anim name="idle" anim="{name} idle" fps="12" loop="true"/>
    <anim name="singUP" anim="{name} singUP" fps="24" loop="false"/>
    <anim name="singLEFT" anim="{name} singLEFT" fps="24" loop="false"/>
    <anim name="singRIGHT" anim="{name} singRIGHT" fps="24" loop="false"/>
    <anim name="singDOWN" anim="{name} singDOWN" fps="24" loop="false"/>
</character>'''

    with open(os.path.join(data_dir, f"{name}.xml"), 'w') as f:
        f.write(char_xml)

    # –ò–∫–æ–Ω–∫–∞
    icons_dir = os.path.join(output_dir, "images/icons")
    os.makedirs(icons_dir, exist_ok=True)

    icon = img.resize((150, 150), Image.Resampling.LANCZOS)
    icon_sheet = Image.new('RGBA', (300, 150), (0, 0, 0, 0))
    icon_sheet.paste(icon, (0, 0), icon)

    # Losing state (red tint)
    losing_data = np.array(icon)
    mask = losing_data[:,:,3] > 0
    losing_data[mask, 0] = np.minimum(255, losing_data[mask, 0] + 50)
    losing_data[mask, 1] = np.maximum(0, losing_data[mask, 1] - 30)
    losing = Image.fromarray(losing_data)
    icon_sheet.paste(losing, (150, 0), losing)
    icon_sheet.save(os.path.join(icons_dir, f"icon-{name}.png"))

    print(f"‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–∂ '{name}' —Å–æ–∑–¥–∞–Ω!")

if __name__ == "__main__":
    if len(sys.argv) < 3:
        print("Usage: python create_character.py image.png character_name")
        sys.exit(1)

    create_character(sys.argv[1], sys.argv[2], "assets")
```

---

## üéØ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–µ–ª–æ–∫ —Å –º—É–∑—ã–∫–æ–π (Audio Analysis)

### –¢–µ–æ—Ä–∏—è

–î–ª—è —Ç–æ—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ω–æ—Ç —Å –º—É–∑—ã–∫–æ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–Ω–∞–ª–∏–∑ –∞—É–¥–∏–æ:

1. **BPM Detection** - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–º–ø–∞ –ø–µ—Å–Ω–∏
2. **Onset Detection** - –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π (—É–¥–∞—Ä—ã, –Ω–æ—Ç—ã)
3. **Quantization** - –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —Ä–∏—Ç–º–∏—á–µ—Å–∫–æ–π —Å–µ—Ç–∫–µ
4. **Offset** - –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –∑–∞–¥–µ—Ä–∂–∫–∏

### –ê–ª–≥–æ—Ä–∏—Ç–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```python
import librosa
import numpy as np

# 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ
y, sr = librosa.load('Inst.ogg')
duration = len(y) / sr

# 2. HPSS - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –≥–∞—Ä–º–æ–Ω–∏–∫—É –∏ –ø–µ—Ä–∫—É—Å—Å–∏—é
y_harmonic, y_percussive = librosa.effects.hpss(y)

# 3. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ BPM (3 –º–µ—Ç–æ–¥–∞ –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏)
onset_env = librosa.onset.onset_strength(y=y_percussive, sr=sr)
tempo1, _ = librosa.beat.beat_track(onset_envelope=onset_env, sr=sr)

tempo2, _ = librosa.beat.beat_track(y=y, sr=sr)

tempogram = librosa.feature.tempogram(onset_envelope=onset_env, sr=sr)
tempo3 = librosa.feature.tempo(onset_envelope=onset_env, sr=sr)[0]

BPM = np.median([tempo1, tempo2, tempo3])  # –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ

# 4. –†–∞—Å—á—ë—Ç —Ä–∏—Ç–º–∏—á–µ—Å–∫–æ–π —Å–µ—Ç–∫–∏
beat_ms = 60000 / BPM
grid_1_4 = beat_ms           # –ß–µ—Ç–≤–µ—Ä—Ç—å –Ω–æ—Ç—ã
grid_1_8 = beat_ms / 2       # –í–æ—Å—å–º–∞—è –Ω–æ—Ç–∞
grid_1_16 = beat_ms / 4      # –®–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç–∞—è –Ω–æ—Ç–∞

# 5. Onset Detection
onsets = librosa.onset.onset_detect(
    y=y_percussive, sr=sr,
    wait=1, pre_avg=1, post_avg=1,
    pre_max=1, post_max=1,
    units='time'
)
onsets_ms = onsets * 1000

# 6. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ offset (–ø–µ—Ä–≤—ã–π onset)
OFFSET_MS = onsets_ms[0] if len(onsets_ms) > 0 else 0

# 7. –ö–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è –∫ —Å–µ—Ç–∫–µ
def quantize(time_ms, grid, offset):
    adjusted = time_ms - offset
    quantized = round(adjusted / grid) * grid
    return quantized + offset

quantized_notes = [quantize(t, grid_1_8, OFFSET_MS) for t in onsets_ms]
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞—á–µ—Å—Ç–≤–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|----------|--------------|
| **BPM** | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å 3 –º–µ—Ç–æ–¥–∞–º–∏, –≤–∑—è—Ç—å –º–µ–¥–∏–∞–Ω—É |
| **Grid** | 1/8 –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, 1/16 –¥–ª—è hard |
| **Offset** | –ü–µ—Ä–≤—ã–π onset –∏–ª–∏ —Ä—É—á–Ω–∞—è –ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ |
| **Min gap** | grid * 0.8-0.9 (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±–ª–∏–∑–∫–∏—Ö –Ω–æ—Ç) |

### –¢–∏–ø—ã onset detection

```python
# Strict - —Ç–æ–ª—å–∫–æ —á—ë—Ç–∫–∏–µ —É–¥–∞—Ä—ã (–º–µ–Ω—å—à–µ –Ω–æ—Ç)
onsets_strict = librosa.onset.onset_detect(
    y=y_percussive, sr=sr,
    wait=2, pre_avg=2, post_avg=2,
    pre_max=2, post_max=2,
    delta=0.07
)

# Default - –±–∞–ª–∞–Ω—Å
onsets_default = librosa.onset.onset_detect(
    y=y_percussive, sr=sr,
    wait=1, pre_avg=1, post_avg=1,
    pre_max=1, post_max=1
)

# Sensitive - –±–æ–ª—å—à–µ –Ω–æ—Ç (–¥–ª—è hard)
onsets_sensitive = librosa.onset.onset_detect(
    y=y, sr=sr,  # –ü–æ–ª–Ω—ã–π —Å–∏–≥–Ω–∞–ª
    wait=1, pre_avg=1, post_avg=1,
    pre_max=1, post_max=1,
    delta=0.03
)
```

### –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ (DANIEL)

```json
{
  "audio_file": "Inst.ogg",
  "duration_sec": 187.05,
  "tempo": {
    "method1_percussion": 129.2,
    "method2_full": 129.2,
    "method3_tempogram": 129.2,
    "selected": 129.2
  },
  "grid_ms": {
    "1/4": 464.4,
    "1/8": 232.2,
    "1/16": 116.1
  },
  "onsets": {
    "strict_count": 420,
    "default_count": 735,
    "sensitive_count": 808
  },
  "timing": {
    "first_onset_ms": 70.0,
    "recommended_offset_ms": 70.0
  }
}
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –Ω–æ—Ç

```python
# –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è: 0=LEFT, 1=DOWN, 2=UP, 3=RIGHT
patterns = [
    [0, 1, 2, 3],  # L D U R
    [3, 2, 1, 0],  # R U D L
    [0, 2, 1, 3],  # L U D R
    [1, 3, 0, 2],  # D R L U
    [2, 0, 3, 1],  # U L R D
]

notes = []
pattern_idx = 0
for i, time_ms in enumerate(quantized_notes):
    if i % 8 == 0 and i > 0:
        pattern_idx = (pattern_idx + 1) % len(patterns)

    direction = patterns[pattern_idx][i % 4]
    notes.append({
        "id": direction,
        "sLen": 0,        # –î–ª–∏–Ω–∞ —É–¥–µ—Ä–∂–∞–Ω–∏—è (0 = tap)
        "time": int(time_ms),
        "type": 0
    })
```

### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ–∂–¥—É –∏–≥—Ä–æ–∫–æ–º –∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–º

```python
NOTES_PER_TURN = 16  # –ù–æ—Ç –¥–æ —Å–º–µ–Ω—ã

notes_opponent = []
notes_player = []

for i, note in enumerate(all_notes):
    if (i // NOTES_PER_TURN) % 2 == 0:
        notes_opponent.append(note)
    else:
        notes_player.append(note)
```

### Freeplay Registration

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Å–Ω–∏ –≤ Freeplay, –¥–æ–±–∞–≤—å—Ç–µ –∏–º—è –ø–µ—Å–Ω–∏ –≤:
```
data/config/freeplaySonglist.txt
```

–ü—Ä–∏–º–µ—Ä:
```
tutorial
bopeebo
fresh
...
daniel    <- –≤–∞—à–∞ –ø–µ—Å–Ω—è
```

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Codename Engine GitHub](https://github.com/CodenameCrew/CodenameEngine)
- [librosa Documentation](https://librosa.org/doc/latest/)
- [GameBanana FNF Mods](https://gamebanana.com/games/8694)
- [FNF Chart Visualizer](https://jsm925.github.io/FunkinChart/)

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞

### –ù–æ–≤—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂
- [ ] –ö–∞—Ä—Ç–∏–Ω–∫–∞ —Å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º —Ñ–æ–Ω–æ–º
- [ ] –°–ø—Ä–∞–π—Ç-–ª–∏—Å—Ç (`images/characters/name.png`)
- [ ] XML –∞–Ω–∏–º–∞—Ü–∏–π (`images/characters/name.xml`)
- [ ] Character XML (`data/characters/name.xml`)
- [ ] –ò–∫–æ–Ω–∫–∞ (`images/icons/icon-name.png`)
- [ ] Menu character (`images/menus/storymenu/characters/name.png`)
- [ ] Week character XML (`data/weeks/characters/name.xml`)

### –ù–æ–≤–∞—è –ø–µ—Å–Ω—è
- [ ] –ê—É–¥–∏–æ —Ñ–∞–π–ª (`songs/name/song/Inst.ogg`)
- [ ] meta.json (`songs/name/meta.json`)
- [ ] –ß–∞—Ä—Ç (`songs/name/charts/normal.json`)
- [ ] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –Ω–µ–¥–µ–ª–µ

### –ù–æ–≤–∞—è –Ω–µ–¥–µ–ª—è
- [ ] Week XML (`data/weeks/weeks/name.xml`)
- [ ] –ö–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è (`images/menus/storymenu/weeks/name.png`)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ `weeks.txt`

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–µ–∫—Ç–∞ WEEK D —Å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏ Green Stick (opponent), BF (player), GF*
*–§–æ–Ω: Minecraft Forest | Audio: DANIEL (129.2 BPM, offset 70ms)*

---

## üé¨ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Å–º–µ–Ω–∞ —Ñ–æ–Ω–æ–≤ –ø–æ –≤—Ä–µ–º–µ–Ω–∏

### Stage —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ñ–æ–Ω–∞–º–∏

```xml
<!DOCTYPE codename-engine-stage>
<stage zoom="0.9" name="mystage" folder="stages/mystage/">
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ–Ω (–≤–∏–¥–∏–º—ã–π) -->
    <sprite name="bg1" x="0" y="0" sprite="background1" visible="true"/>
    
    <!-- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ–Ω (—Å–∫—Ä—ã—Ç—ã–π) -->
    <sprite name="bg2" x="0" y="0" sprite="background2" visible="false">
        <anim name="idle" anim="anim" fps="10" loop="true"/>
    </sprite>
    
    <girlfriend/>
    <dad/>
    <boyfriend/>
</stage>
```

### HScript –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è (songs/[song]/scripts/background_switch.hx)

```haxe
import flixel.FlxSprite;
import flixel.text.FlxText;

var bg1:FlxSprite;
var bg2:FlxSprite;
var timerText:FlxText;
var bg2Active:Bool = false;

// –¢–∞–π–º–∏–Ω–≥–∏ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
var BG2_START:Float = 93000;  // 1:33
var BG2_END:Float = 155000;   // 2:35

function onCreate() {
    bg1 = PlayState.instance.stage.getNamedProp("bg1");
    bg2 = PlayState.instance.stage.getNamedProp("bg2");
    
    // –¢–∞–π–º–µ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    timerText = new FlxText(10, 10, 200, "0:00");
    timerText.setFormat(null, 16, 0xFFFFFF, "left");
    timerText.scrollFactor.set(0, 0);
    PlayState.instance.add(timerText);
}

function onUpdate(elapsed:Float) {
    var songPos = Conductor.songPosition;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä
    var seconds = Math.floor(songPos / 1000);
    var mins = Math.floor(seconds / 60);
    var secs = seconds % 60;
    timerText.text = mins + ":" + (secs < 10 ? "0" : "") + secs;
    
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ñ–æ–Ω–æ–≤
    if (songPos >= BG2_START && songPos < BG2_END) {
        if (!bg2Active) {
            bg1.visible = false;
            bg2.visible = true;
            bg2.animation.play("idle");
            bg2Active = true;
        }
    } else if (bg2Active) {
        bg2.visible = false;
        bg1.visible = true;
        bg2Active = false;
    }
}
```

### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏

| –§–æ—Ä–º–∞—Ç | –ú–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã |
|--------|--------------|
| 0:30 | 30000 |
| 1:00 | 60000 |
| 1:33 | 93000 |
| 2:00 | 120000 |
| 2:35 | 155000 |
| 3:00 | 180000 |

**–§–æ—Ä–º—É–ª–∞:** `–º–∏–Ω—É—Ç—ã * 60000 + —Å–µ–∫—É–Ω–¥—ã * 1000`
